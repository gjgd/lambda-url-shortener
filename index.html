<html>
  <head>
    <meta charset="UTF-8">
  </head>

  <body>
    <input type="text" id="url" placeholder="Input URL to shorten">
    <button onclick="shortenUrl()">Shorten</button>
    <div id="result"></div>
    <div id="error"></div>
    <br/>
    <br/>
    <br/>
    Check the source code on <a href="https://github.com/gjgd/lambda-url-shortener" target="_blank">Github</a>
  </body>

  <script type="text/javascript">
    // https://stackoverflow.com/questions/5717093/check-if-a-javascript-string-is-a-url
    function isValidUrl(string) {
      try {
        new URL(string);
      } catch (_) {
        return false;
      }

      return true;
    }

    function shortenUrl() {
      const el = document.getElementById('url');
      const url = el.value;
      if(!isValidUrl(url)) {
        const errorEl = document.getElementById('error');
        errorEl.innerHTML = `"${url}" is not a valid URL`;
      } else {
        fetch('/', {
          method: 'POST',
          headers: {
            "Content-type": "application/json; charset=UTF-8"
          },
          body: JSON.stringify({ url }),
        })
        .then(res => {
          if (res.ok) {
            res.json();
          } else {
            throw new Error();
          }
        })
        .then((data) => {
          const successEl = document.getElementById('result');
          successEl.innerHTML = `Your short URL is <a href="https://${data.shortUrl}" target="_blank">${data.shortUrl}</a>`;
        })
        .catch((error) => {
          const errorEl = document.getElementById('error');
          errorEl.innerHTML = 'An error has happened, please try again later';
        });
      }
    }
  </script>
</html>
